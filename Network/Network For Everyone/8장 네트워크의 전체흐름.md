# 8장 네트워크의 전체 흐름
OSI모델의 전체 흐름에 대해 알아보자.  
이 장의 목표 :  
1. OSI 모델의 전체 흐름을 이해한다
2. 웹에 접속할때 이루어지는 캡슐화와 역캡슐화를 이해한다.  

# Lesson 32. 랜 카드에서의 데이터 전달과 처리
2~7장까지 OSI모델의 계층에 대해서 알아봤다. 이 장에서는 웹사이트에 방문했을 때 이루어지는 전체적인 데이터 처리 과정에 대해 알아보자  

## 1 네트워크의 구성 
OSI 모델의 각 계층 간에 데이터가 전달되고 처리되는 전체 과정을 알아보자.  
웹사이트에 접속할 때 아래 그림과 같은 OSI 모델 상위 응용 계층부터 하위 물리 계층까지에서 각각 어떤 일이 일어나는지 알아보자.  
![image](https://user-images.githubusercontent.com/68311318/122678372-8d38dd80-d221-11eb-9b55-77ba37e319b8.png)
예를 들어 아래 그림과 같이 컴퓨터, 스위치, 라우터, 웹서버로 구성된 네트워크가 있다고 가정해보자. 이 구성은 몇개의 네트워크로 나누어져 있는가.  
![image](https://user-images.githubusercontent.com/68311318/122678447-ed2f8400-d221-11eb-99de-a712ffa9feab.png)  
답은 192.168.0/24, 172.16.0.0/16, 192.168.10.0/24로 총 세개이다. 위 그림을 OSI모델로 나타내면 다음 그림과 같이 구성된다.  
![image](https://user-images.githubusercontent.com/68311318/122678529-4697b300-d222-11eb-8a93-882f48bd37b2.png)  

## 2 컴퓨터의 데이터가 전기 신호로 변환되는 과정
지금까지 OSI 모델의 각 계층에 대해 살펴봤으니 이번에는 OSI모델의 전체적인 관점으로 데이터가 전달되고 처리되는 과정을 살펴보자. 구체적으로 컴퓨터의 웹브라우저에 URL을 입력할때부터 웹서버에 도착할 때까지 이루어지는 OSI모델의 `캡슐화`와 `역캡슐화`를 살펴보자.  
먼저 컴퓨터에서 OSI모델의 캡슐화가 이루어진다. 웹사이트에 접속해야하므로 응용계층에서 시작한다. 아래 그림과 같이 웹브라우저에 URL을 입력하고 엔터키를 누르면 캡슐화가 시작된다. 단, 3-way 핸드셰이크는 이미 완료되어 연결이 확립되어 있다고 가정한다. 컴퓨터에서 웹브라우저를 이용하여 웹서버의 웹사이트에 접속하기 위한 요청을 보낼 때 사용하는 것이 HTTP 프로토콜이다. 응용계층에서는 웹서버에 있는 html데이터를 얻어야 하므로 아래 그림처럼 'GET/index.html HTTP/1.1 ~' 과 같은 HTTP메시지를 보낸다.  
![image](https://user-images.githubusercontent.com/68311318/122678731-f9681100-d222-11eb-9206-b7f093582975.png)  
HTTP메시지의 GET은 데이터를 보내달라는 의미이다.  
계속해서 이 데이터가 전송계층에 전달된다. 전송 계층에서는 TCP헤더가 붙는다. 전송계층의 TCP헤더에서 어느 애플리케이션에 데이터를 보내야하는지 식별하는데 필요한 번호가 뭘까. 출발지 포트번호와 목적지 포트번호이다. 출발치 포트번호(웹 브라우저)는 잘 알려진 포트가 아닌 포트(1025번 이상인 포트)중에서 무작위로 선택된다. 여기서는 3500번 포트를 사용했다고 가정하자. 한편 목적지 포트 번호는 HTTP이므로 80번 포트가 된다. 이 TCP헤더를 가진 데이터를 세그먼트라고 한다. 아래 그림과 같이 TCP헤더가 붙어 세그먼트가 된다.  
![image](https://user-images.githubusercontent.com/68311318/122678861-7abfa380-d223-11eb-97b5-b164b84b23de.png)  
그 다음에는 데이터가 네트워크 계층에 전달된다. 이 때 네트워크 계층에서는 IP헤더가 붙는다. 네트워크 계층에서는 전송계층에서 전달받은 세그먼트(데이터)에 IP헤더를 붙인다. 그 IP헤더에 출발지 컴퓨터와 목적지 서버의 위치가 추가되는데, 출발지 IP주소와 목적지 IP주소가 추가되는 것이다. IP헤더가 붙은 데이터를 IP패킷이라고 한다.  
![image](https://user-images.githubusercontent.com/68311318/122678979-ea359300-d223-11eb-95ca-0a942a987779.png)  
그다음에는 데이터 링크 계층으로 전달되고 이더넷 헤더가 추가된다. 이더넷 헤더가 있는 데이터를 이더넷 프레임이라고 한다. 그다음으로 물리계층에서 전기 신호로 변환데어 네트워크로 전송된다.  
이처럼 응용계층에서 데이터 링크 계층까지 헤더가 많이 붙는다. 헤더는 목적지로 데이터를 전송하는데 모두 필요하다.  
데이터를 물리계층에서 전기신호로 변환할때 랜카드가 사용된다.  
![image](https://user-images.githubusercontent.com/68311318/122679099-8069b900-d224-11eb-98af-d71c2245e42c.png)  
지금까지 컴퓨터의 데이터가 랜 카드에서 전기신호로 변환되는 흐름을 살펴보았다. 다음에는 스위치와 라우터에서의 데이터 흐름을 알아보자.  

## 정리
- 웹에 접속할때는 OSI모델의 상위계층부터 캡슐화가 이루어진다.
- 웹서버에 요청을 보낼때는 HTTP를 사용한다
- 웹서버에 있는 html파일을 요청하는 경우에는 GET /index.html HTTP/1.1과 같은 HTTP메시지를 보낸다
- 전송 계층에서는 TCP헤더가 추가되며 이를 세그먼트라고 부른다.
- 네트워크 계층에서는 IP헤더가 추가되며 이를 IP패킷이라고 부른다.
- 데이터 링크 계층에서는 이더넷 헤더와 트레일러(FCS)가 추가되며 이를 이더넷 프레임이라고 부른다
- 물리 계층에서는 데이터가 전기신호로 변환되어 전송된다.